#### 可以升级合约方法

| 策略            | 优点                              | 缺点                                                 | 介绍                                                                                                                                                                        |
|---------------|---------------------------------|----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 代理合约（Proxy合约） | 升级合约不需要重新设计                     | proxy合约代码并不反映他存储合约代码的状态，不能改变现有目标合约的域但是可以增加新的域      | 代理合约的主要思想是通过delegatecall指令/opcode来调用目标合约里的函数，而且目标合约时可升级的                                                                                                                  |
| 分离逻辑和数据       | 数据可以从数据合约里读取，数据合约里的数据结构可以被修改和添加 | 合约需要拆分成数据合约和程序逻辑合约，复杂的数据类型，如struct可以被修改，但是修改起来比较复杂 | 分离逻辑和数据的主要思想是将合约的数据（变量、结构体、映射等）和相关的getter、setter函数放在数据合约里；将所有逻辑代码的实现放在一个逻辑合约里。这样即使逻辑发生了变化，数据还在同一个地方，这种方法允许逻辑的全部升级。合约可以通过引导用户使用新的逻辑合约（通过DNS解析器），并且修改数据权限来执行getter和setter函数 |
| 用键值对来分离逻辑和数据  | 键值对更为通用和简单，数据合约里的数据可以被修改和添加     | 合约需要拆分成数据合约和程序逻辑合约，因为都是通过键值对来访问；访问数据非常抽象           | 这种方法和分离逻辑和数据的方法大致相同。唯一的区别在于访问数据时，所有的数据都经过了抽象化从而可以通过键值对来访问。                                                                                                                |
| 部分可升级的合约系统    | 合约里简单的部分可以不变以获取信任               | 不可升级的代码永远不能升级                                      | 尽量不升级合约的核心功能，其他部分采用可升级策略                                                                                                                                                  |

#### 例子

###### 代理合约可升级模式的demo [README.md](code%2F%E5%8F%AF%E5%8D%87%E7%BA%A7%E5%90%88%E7%BA%A6-%E4%BB%A3%E7%90%86%E5%90%88%E7%BA%A6%2FREADME.md)

##### 创建全部可升级合约有一个很大的信任问题，即合约的不可篡改性。如果合约可以全部升级，表明合约在发布部署后可以改动，而这严重违反了智能合约不可篡改的约定。所以在很多情况下，通行的做法是设计部分可升级合约。合约的核心功能是不可以升级的，而其他部分可以使用可升级策略。

#### 利用openzeppelin编写可升级合约

- 例子：[手动部署OpenZeppelin可升级合约 - angry-baby - 博客园.pdf](..%2Fstatic%2F%E6%89%8B%E5%8A%A8%E9%83%A8%E7%BD%B2OpenZeppelin%E5%8F%AF%E5%8D%87%E7%BA%A7%E5%90%88%E7%BA%A6%20-%20angry-baby%20-%20%E5%8D%9A%E5%AE%A2%E5%9B%AD.pdf)
- 编写可升级合约时候，变量的新增与修改： https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable